A51 MACRO ASSEMBLER  EVS6                                                                 10/26/2023 11:21:02 PAGE     1


MACRO ASSEMBLER A51 V8.02b
OBJECT MODULE PLACED IN Evs6.OBJ
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE Evs6.a51 SET(SMALL) DEBUG EP

LOC  OBJ            LINE     SOURCE

0000                   1     ORG 0000H
  00C0                 2     P4 EQU 0C0H
  00C5                 3     ADCON EQU 0C5H
  00C6                 4     ADCH EQU 0C6H
  0005                 5     DELAY EQU 5
  0008                 6     CHANNELS_COUNT EQU 8
  0020                 7     INDEX_ADDR EQU 20h
  0009                 8     PWMP_VAL EQU 9
                       9     ;IS_READY:
                      10     ;MOV DPTR, #7ffbh ; address with ready flag
                      11     ;MOVX A, @DPTR
                      12     ;ANL A, #01
                      13     ;JZ IS_READY; wait for ready flag
                      14     
0000 758901           15     MOV TMOD, #00000001b; mode 1
0003 752000           16     MOV INDEX_ADDR, #0; init index, i
0006                  17     MAIN_ADC_PWM_CYCLE:
0006 7408             18     MOV A, #CHANNELS_COUNT
0008 9520             19     SUBB A, INDEX_ADDR
000A 603E             20     JZ END_MAIN_CYCLE
000C E520             21     MOV A, INDEX_ADDR; A = i
                      22     ; read value from channel with index i
000E 25C5             23     ADD A, ADCON
0010 F5C5             24     MOV ADCON, A; now ADCON contains index of channel
0012                  25     CHECK_FLAGS_ADCI_ADCS:
0012 E5C5             26     MOV A, ADCON
0014 5418             27     ANL A, #18H ;check flags ADCI and ADCS
0016 70FA             28     JNZ CHECK_FLAGS_ADCI_ADCS
                      29     
0018 75C508           30     MOV ADCON, #08H ; start ADC
001B E5C5             31     WAIT_ADC: MOV A,ADCON
001D 5410             32     ANL A, #10H
001F 60FA             33     JZ WAIT_ADC ;wait for ADC read value from channel
0021 E5C6             34     MOV A, ADCH ;read result of ADC work
                      35     ;---work with pwm---
0023                  36     MOV PWM0, #00h
*** _____________________________^
*** ERROR #A45 IN 36 (Evs6.a51, LINE 36): UNDEFINED SYMBOL (PASS-2)
                      37     ;now lets make delay
0026 75F005           38     MOV B, #DELAY; external cycle
0029 ABF0             39     MOV R3, B
002B 7427             40     MOV A, #027h            
002D FA               41     MOV R2, A; inner cycle seconds R2 = DELAY * B * 0.026
002E C28C             42         START: CLR TR0              ;reset counter
0030 758A00           43             MOV TL0, #000h;init value
0033 D28C             44             SETB TR0                ;start count
0035 108D02           45             CLOCK:JBC TF0, FINISH   
0038 80FB             46                JMP CLOCK
003A DAF2             47                FINISH: DJNZ R2, START
003C FA               48                 MOV R2, A
003D DBEF             49                 DJNZ R3, START
                      50     
003F 75C500           51     MOV ADCON, #00h; reset flags
0042                  52     NEXT_INDEX:
0042 E520             53     MOV A, INDEX_ADDR
0044 04               54     INC A
0045 F520             55     MOV INDEX_ADDR, A
0047 020006           56     LJMP MAIN_ADC_PWM_CYCLE
A51 MACRO ASSEMBLER  EVS6                                                                 10/26/2023 11:21:02 PAGE     2

                      57     
                      58     
                      59     ;M1: MOV A,ADCON
                      60     ;ANL A,#18H ;check flags ADCI and ADCS
                      61     ;JNZ M1
                      62     ;MOV ADCON,#08H ; start ADC
                      63     ;MM5: MOV A,ADCON
                      64     ;ANL A,#10H
                      65     ;JZ MM5 ;wait for ADC read value from channel 0
                      66     ;MOV A,ADCH ;read result of ADC work
                      67     ;SWAP A; ---do smth with A---
                      68     ;MOV P4,A 
                      69     ;MOV ADCON,#00H ;reset flags
                      70     ;LJMP M1
                      71     
004A                  72     END_MAIN_CYCLE:
                      73     END
A51 MACRO ASSEMBLER  EVS6                                                                 10/26/2023 11:21:02 PAGE     3

SYMBOL TABLE LISTING
------ ----- -------


N A M E                T Y P E  V A L U E   ATTRIBUTES

ADCH. . . . . . . . .  N NUMB   00C6H   A   
ADCON . . . . . . . .  N NUMB   00C5H   A   
B . . . . . . . . . .  D ADDR   00F0H   A   
CHANNELS_COUNT. . . .  N NUMB   0008H   A   
CHECK_FLAGS_ADCI_ADCS  C ADDR   0012H   A   
CLOCK . . . . . . . .  C ADDR   0035H   A   
DELAY . . . . . . . .  N NUMB   0005H   A   
END_MAIN_CYCLE. . . .  C ADDR   004AH   A   
FINISH. . . . . . . .  C ADDR   003AH   A   
INDEX_ADDR. . . . . .  N NUMB   0020H   A   
MAIN_ADC_PWM_CYCLE. .  C ADDR   0006H   A   
NEXT_INDEX. . . . . .  C ADDR   0042H   A   
P4. . . . . . . . . .  N NUMB   00C0H   A   
PWM0. . . . . . . . .    ----   -----       
PWMP_VAL. . . . . . .  N NUMB   0009H   A   
START . . . . . . . .  C ADDR   002EH   A   
TF0 . . . . . . . . .  B ADDR   0088H.5 A   
TL0 . . . . . . . . .  D ADDR   008AH   A   
TMOD. . . . . . . . .  D ADDR   0089H   A   
TR0 . . . . . . . . .  B ADDR   0088H.4 A   
WAIT_ADC. . . . . . .  C ADDR   001BH   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 1 ERROR(S)
