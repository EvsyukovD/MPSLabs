A51 MACRO ASSEMBLER  EVS2                                                                 09/26/2023 15:01:27 PAGE     1


MACRO ASSEMBLER A51 V8.02b
OBJECT MODULE PLACED IN Evs2.OBJ
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE Evs2.a51 SET(SMALL) DEBUG EP

LOC  OBJ            LINE     SOURCE

                       1     ;F(X3,X2,X1,X0) == 1 <=> 1,4,6,8,9,11,14
0000                   2     ORG 0000h;
  0011                 3     BASEADDRESS EQU 0011h;11h
  0004                 4     RELATIVEADDRESS EQU 0004h;04h
0000 020003            5     LJMP MAIN
                       6     
0003                   7     MAIN:
                       8     ; init values for timer in every case: 1...5 sec wait
0003 754005            9     MOV 40H, #5 ;0;  make "table" for number of seconds for each tuple (x3,x2,x1,x0)
0006 754102           10     MOV 41H, #2 ;1
0009 754201           11     MOV 42H, #1 ;2
000C 754301           12     MOV 43H, #1 ;3
000F 754401           13     MOV 44H, #1 ;4
0012 754503           14     MOV 45H, #3 ;5
0015 754603           15     MOV 46H, #3 ;6
0018 754701           16     MOV 47H, #1 ;7
001B 754805           17     MOV 48H, #5;8
001E 754904           18     MOV 49H, #4;9
0021 754A01           19     MOV 4AH, #1;10
0024 754B02           20     MOV 4BH, #2;11
0027 754C01           21     MOV 4CH, #1;12
002A 754D01           22     MOV 4DH, #1;13
002D 754E01           23     MOV 4EH, #1;14
0030 754F01           24     MOV 4FH, #1;15
  00C0                25     P4 EQU 0C0h
0033 908000           26     MOV DPTR, #8000h
0036 7404             27     MOV A,#04h ;0004h - relative address OFFSET
0038 F0               28     MOVX @DPTR, A 
0039 908004           29     MOV DPTR,#8004h
003C 7411             30     MOV A, #11h; 0011h - base address OFFSET
003E F0               31     MOVX @DPTR, A
003F 7452             32     MOV A,  #01010010b
0041 908011           33     MOV DPTR, #8011h
0044 F0               34     MOVX  @DPTR, A          ;0-7 truth table in ex memory
                      35     ;MOV DPTR, #8001h
0045 744B             36     MOV A,  #01001011b
0047 908012           37     MOV DPTR, #8012h
004A F0               38     MOVX @DPTR, A ;8-15 truth table in ex memory
004B C2C0             39     CLR P4.0;
004D D2C1             40     SETB P4.1;
004F                  41     MET1:
004F 907FFB           42     MOV DPTR,#7FFBh ;address isReady flag
0052                  43     isReady:                ;check flag isReady
0052 E0               44     MOVX A,@DPTR    ;read flag
0053 5401             45     ANL A,#01h              ;select 0 bit
0055 60FB             46     JZ isReady
0057 907FFA           47     MOV DPTR,#7FFAh ;addres of (x3,x2,x1,x0) tuple
005A E0               48     MOVX A,@DPTR    ;write tuple to A
005B F520             49     MOV 20h, A              ;write x3,x2,x1,x0 to 20h
                      50     ; F(x3,x2,x1,x0) = ^x0 & x2 & x1 v ^x3 & ^x0 & x2 v ^x2 & ^x1 & x0 v x3 & ^x2 & (x0 v ^x1)
                      51     ;X3 - 3, X2 - 2, X1 - 1, X0 - 0
                      52     
005D A2E0             53     MOV C, ACC.0 ;C = X0
005F B3               54     CPL C;C = ^X0
0060 82E2             55     ANL C, ACC.2; C = ^X0 & X2
0062 82E1             56     ANL C, ACC.1; C = ^X0 & X2 & X1
0064 9204             57     MOV 20h.4, C; 03 = ^X0 & X2 & X1 -- 1
                      58     
A51 MACRO ASSEMBLER  EVS2                                                                 09/26/2023 15:01:27 PAGE     2

0066 A2E3             59     MOV C, ACC.3;C = X3
0068 72E0             60     ORL C, ACC.0; C = X3 V X0
006A B3               61     CPL C; C = ^X3 & ^X0
006B 82E2             62     ANL C, ACC.2; C = ^X3 & ^X0 & X2
006D 7204             63     ORL C, 20h.4; C = ^x0 & x2 & x1 v ^x3 & ^x0 & x2
006F 9204             64     MOV 20h.4, C; 03 = ^x0 & x2 & x1 v ^x3 & ^x0 & x2 -- 2
                      65     
0071 A2E2             66     MOV C, ACC.2;C = X2
0073 72E1             67     ORL C, ACC.1; C = X2 V X1
0075 B3               68     CPL C; C = ^X2 & ^X1
0076 82E0             69     ANL C, ACC.0; C = ^X2 & ^X1 & X0
0078 7204             70     ORL C, 20h.4; C = ^x0 & x2 & x1 v ^x3 & ^x0 & x2 v ^x2 & ^x1 & x0
007A 9204             71     MOV 20h.4, C; 03 = ^x0 & x2 & x1 v ^x3 & ^x0 & x2 v ^x2 & ^x1 & x0 -- 4
                      72     
007C A2E1             73     MOV C, ACC.1; C = X1
007E B3               74     CPL C; C = ^X1
007F 72E0             75     ORL C, ACC.0; C = X0 V ^X1
0081 B3               76     CPL C; C = ^X0 & X1
0082 72E2             77     ORL C, ACC.2; C = X2 V (^X0 & X1)
0084 B3               78     CPL C; C = ^X2 & (X0 V ^X1)
0085 82E3             79     ANL C, ACC.3; C = X3 & ^X2 & (X0 V ^X1)
0087 7204             80     ORL C, 20h.4; C = ^x0 & x2 & x1 v ^x3 & ^x0 & x2 v ^x2 & ^x1 & x0 v x3 & ^x2 & (x0 v ^x1)
0089 92C0             81     MOV     P4.0,C  ;res:=F
                      82     ; LOADING IDEALS
008B 20E312           83     JB ACC.3, SECOND        ;IF CASE >7
008E 908000           84     MOV DPTR, #8000h
0091 E0               85     MOVX A, @DPTR; A = RELATIVE ADDRESS
0092 F582             86     MOV  DPL, A
0094 E0               87     MOVX A, @DPTR;A = BASE ADDRESS
0095 F582             88     MOV DPL, A
0097 E0               89     MOVX A, @DPTR; A = IDEALS
0098 8520F0           90     MOV B, 20h
009B 53F007           91     ANL B, #00000111b
                      92     ;--------
009E 01B2             93     AJMP NEXT;
00A0                  94     SECOND:
00A0 908000           95     MOV DPTR, #8000h
00A3 E0               96     MOVX A, @DPTR; A = RELATIVE ADDRESS
00A4 F582             97     MOV DPL, A
00A6 E0               98     MOVX A, @DPTR; A = BASE ADDRESS
00A7 2401             99     ADD A,#0001h
00A9 F582            100     MOV DPL, A
00AB E0              101     MOVX A, @DPTR; A = IDEALS
00AC 8520F0          102     MOV B, 20h
00AF 53F00F          103     ANL B, #00001111b
00B2                 104     NEXT:
00B2 C5F0            105     XCH A, B                ; A = counter
00B4 6006            106     JZ END_OF_CYCLE ; if count = 0
00B6 C5F0            107     XCH A, B                ; A = half of truth table, B = count
00B8                 108     cycle:
00B8 03              109     RR A;
00B9 D5F0FC          110     DJNZ B, cycle;
00BC                 111     END_OF_CYCLE:
00BC F5F0            112     MOV B, A;
00BE A2F0            113     MOV C, B.0              ;bit from table
00C0 B3              114     CPL C                   ; invert c
00C1 92C1            115     MOV P4.1, C             ; P4.1 = inverted bit from table
                     116     
                     117     ;timer - sleep
                     118     ; duration of 1 cycle ~ 0.071 sec
                     119     ; num of cycles which duration not lower than 1 sec is =>15
00C3 E520            120     MOV A, 20h              ; A = X3X2X1X0
00C5 540F            121     ANL A, #00001111b; clear high half
00C7 2440            122     ADD A, #40h             ;address of number
00C9 F9              123     MOV R1, A
00CA E7              124     MOV A, @R1              ; seconds from address (40h + tuple_number)
A51 MACRO ASSEMBLER  EVS2                                                                 09/26/2023 15:01:27 PAGE     3

00CB 758901          125     MOV TMOD,#00000001b     ; mode 1
                     126     
00CE 75F001          127     MOV B, #001h;#0C8h ; 1 external circle
00D1 ABF0            128     MOV R3, B
00D3 14              129     DEC A
00D4 6005            130     JZ SET_7
00D6                 131     SET_E:
00D6 75F00E          132     MOV B, #00Eh;#014h ;number of iterations = 15
00D9 8003            133     JMP MUL_MET
00DB                 134     SET_7:
00DB 75F007          135     MOV B, #007h
00DE                 136     MUL_MET:
00DE E7              137     MOV A, @R1
00DF A4              138     MUL AB                  ; inner circle seconds: 0.071 * B * A
00E0 FA              139     MOV R2, A; inner circle seconds R2 = A * B * 0.071
                     140     
00E1 C28C            141         START: CLR TR0              ;reset counter
00E3 758A00          142             MOV TL0, #000h;#01Ah    ;init value
00E6 D28C            143             SETB TR0                ;start count
00E8 108D02          144             CLOCK:JBC TF0, FINISH   
00EB 80FB            145                JMP CLOCK
00ED DAF2            146                FINISH: DJNZ R2, START
00EF FA              147                 MOV R2, A
00F0 DBEF            148                 DJNZ R3, START
                     149     
                     150     ;next tuple
00F2 907FFA          151     MOV DPTR, #7FFAh
00F5 E0              152     MOVX A, @DPTR
00F6 2401            153     ADD A, #1
00F8 30E402          154     JNB ACC.4, WRITE
00FB                 155     SET_ZERO:
00FB 7400            156     MOV A, #0000h
00FD                 157     WRITE:
00FD F0              158     MOVX @DPTR, A
                     159     
                     160     ; set isReadyBit = 0
00FE 907FFB          161     MOV DPTR,#7FFBh
0101 7400            162     MOV A, #00h
0103 F0              163     MOVX @DPTR, A
0104 014F            164     AJMP MET1;
                     165     END
A51 MACRO ASSEMBLER  EVS2                                                                 09/26/2023 15:01:27 PAGE     4

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

ACC. . . . . . . .  D ADDR   00E0H   A   
B. . . . . . . . .  D ADDR   00F0H   A   
BASEADDRESS. . . .  N NUMB   0011H   A   
CLOCK. . . . . . .  C ADDR   00E8H   A   
CYCLE. . . . . . .  C ADDR   00B8H   A   
DPL. . . . . . . .  D ADDR   0082H   A   
END_OF_CYCLE . . .  C ADDR   00BCH   A   
FINISH . . . . . .  C ADDR   00EDH   A   
ISREADY. . . . . .  C ADDR   0052H   A   
MAIN . . . . . . .  C ADDR   0003H   A   
MET1 . . . . . . .  C ADDR   004FH   A   
MUL_MET. . . . . .  C ADDR   00DEH   A   
NEXT . . . . . . .  C ADDR   00B2H   A   
P4 . . . . . . . .  N NUMB   00C0H   A   
RELATIVEADDRESS. .  N NUMB   0004H   A   
SECOND . . . . . .  C ADDR   00A0H   A   
SET_7. . . . . . .  C ADDR   00DBH   A   
SET_E. . . . . . .  C ADDR   00D6H   A   
SET_ZERO . . . . .  C ADDR   00FBH   A   
START. . . . . . .  C ADDR   00E1H   A   
TF0. . . . . . . .  B ADDR   0088H.5 A   
TL0. . . . . . . .  D ADDR   008AH   A   
TMOD . . . . . . .  D ADDR   0089H   A   
TR0. . . . . . . .  B ADDR   0088H.4 A   
WRITE. . . . . . .  C ADDR   00FDH   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
